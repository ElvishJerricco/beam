
<!DOCTYPE html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="shortcut icon" href="../../assets/images/favicon.png">
      
      <meta name="generator" content="mkdocs-0.16.2, mkdocs-material-1.6.1">
    
    
      
        <title>Models - Beam Documentation</title>
      
    
    
      <script src="../../assets/javascripts/modernizr-56ade86843.js"></script>
    
    

      <link rel="stylesheet" href="../../assets/stylesheets/application-4d0d3f2fbf.css">
      
    
<link rel="stylesheet" type="text/css" href="/css/beam.css"/>

    
      
        
        
        
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
      <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
    
    
      <link rel="stylesheet" href="../../theme/css/beam.css">
    
    
  </head>
  
  
  
  
    <body>
  
    <svg class="md-svg">
      <defs>
        
        
          <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448" viewBox="0 0 416 448" id="github"><path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19T128 352t-18.125-8.5-10.75-19T96 304t3.125-20.5 10.75-19T128 256t18.125 8.5 10.75 19T160 304zm160 0q0 10-3.125 20.5t-10.75 19T288 352t-18.125-8.5-10.75-19T256 304t3.125-20.5 10.75-19T288 256t18.125 8.5 10.75 19T320 304zm40 0q0-30-17.25-51T296 232q-10.25 0-48.75 5.25Q229.5 240 208 240t-39.25-2.75Q130.75 232 120 232q-29.5 0-46.75 21T56 304q0 22 8 38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0 37.25-1.75t35-7.375 30.5-15 20.25-25.75T360 304zm56-44q0 51.75-15.25 82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5T212 416q-19.5 0-35.5-.75t-36.875-3.125-38.125-7.5-34.25-12.875T37 371.5t-21.5-28.75Q0 312 0 260q0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25 30.875Q171.5 96 212 96q37 0 70 8 26.25-20.5 46.75-30.25T376 64q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34 99.5z"/></svg>
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="drawer">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="search">
    <label class="md-overlay" data-md-component="overlay" for="drawer"></label>
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        
          <a href="../.." title="Beam Documentation" class="md-logo md-header-nav__button">
            <img src="../../img/logo.svg" width="24" height="24">
          </a>
        
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <span class="md-flex__ellipsis md-header-nav__title">
          
            
              
                <span class="md-header-nav__parent">
                  User Guide
                </span>
              
            
            Models
          
        </span>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          <label class="md-icon md-icon--search md-header-nav__button" for="search"></label>
          
<div class="md-search" data-md-component="search">
  <label class="md-search__overlay" for="search"></label>
  <div class="md-search__inner">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" required placeholder="Search" accesskey="s" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query">
      <label class="md-icon md-search__icon" for="search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset">close</button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta" data-md-lang-result-none="No matching documents" data-md-lang-result-one="1 matching document" data-md-lang-result-other="# matching documents">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
        
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <div class="md-header-nav__source">
          
            


  


  <a href="https://github.com/tathougies/beam" title="Go to repository" class="md-source" data-md-source="github">
    
      <div class="md-source__icon">
        <svg viewBox="0 0 24 24" width="24" height="24">
          <use xlink:href="#github" width="24" height="24"></use>
        </svg>
      </div>
    
    <div class="md-source__repository">
      tathougies/beam
    </div>
  </a>

          
        </div>
      </div>
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
      
      <main class="md-main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="drawer">
    
      <i class="md-logo md-nav__button">
        <img src="../../img/logo.svg">
      </i>
    
    Beam Documentation
  </label>
  
    <div class="md-nav__source">
      


  


  <a href="https://github.com/tathougies/beam" title="Go to repository" class="md-source" data-md-source="github">
    
      <div class="md-source__icon">
        <svg viewBox="0 0 24 24" width="24" height="24">
          <use xlink:href="#github" width="24" height="24"></use>
        </svg>
      </div>
    
    <div class="md-source__repository">
      tathougies/beam
    </div>
  </a>

    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href="../.." title="Home" class="md-nav__link">
      Home
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../about/faq/" title="Frequently Asked Questions" class="md-nav__link">
      Frequently Asked Questions
    </a>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3" checked>
    
    <label class="md-nav__link" for="nav-3">
      User Guide
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-3">
        User Guide
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../getting-started/" title="Getting Started" class="md-nav__link">
      Getting Started
    </a>
  </li>

        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="toc">
    
    
      <label class="md-nav__link md-nav__link--active" for="toc">
        Models
      </label>
    
    <a href="./" title="Models" class="md-nav__link md-nav__link--active">
      Models
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
  
    <label class="md-nav__title" for="toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#a-simple-model" title="A Simple Model" class="md-nav__link">
    A Simple Model
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#foreign-references" title="Foreign references" class="md-nav__link">
    Foreign references
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#embedding" title="Embedding" class="md-nav__link">
    Embedding
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#defaults" title="Defaults" class="md-nav__link">
    Defaults
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#what-about-tables-without-primary-keys" title="What about tables without primary keys?" class="md-nav__link">
    What about tables without primary keys?
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#more-complicated-relationships" title="More complicated relationships" class="md-nav__link">
    More complicated relationships
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#putting-a-database-together" title="Putting a Database Together" class="md-nav__link">
    Putting a Database Together
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#using-your-database" title="Using your database" class="md-nav__link">
    Using your database
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#a-quick-note-on-backends" title="A quick note on backends" class="md-nav__link">
    A quick note on backends
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#inserting-data" title="Inserting data" class="md-nav__link">
    Inserting data
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
      
      
    </ul>
  
</nav>
    
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../databases/" title="Databases" class="md-nav__link">
      Databases
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../queries/basic/" title="Basic Queries" class="md-nav__link">
      Basic Queries
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../queries/select/" title="More complex SELECTs" class="md-nav__link">
      More complex SELECTs
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../queries/ordering/" title="Ordering" class="md-nav__link">
      Ordering
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../queries/relationships/" title="Relationships" class="md-nav__link">
      Relationships
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../queries/aggregates/" title="Aggregates" class="md-nav__link">
      Aggregates
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../queries/combining-queries/" title="Combining queries" class="md-nav__link">
      Combining queries
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../queries/window-functions/" title="Window functions" class="md-nav__link">
      Window functions
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../queries/advanced-features/" title="Advanced features" class="md-nav__link">
      Advanced features
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4" type="checkbox" id="nav-4">
    
    <label class="md-nav__link" for="nav-4">
      Schema management
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-4">
        Schema management
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../schema-guide/migrations/" title="The Migrations Framework" class="md-nav__link">
      The Migrations Framework
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../schema-guide/tool/" title="The beam-migrate tool" class="md-nav__link">
      The beam-migrate tool
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../schema-guide/supported/" title="Supported migrations" class="md-nav__link">
      Supported migrations
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-5" type="checkbox" id="nav-5">
    
    <label class="md-nav__link" for="nav-5">
      Backends
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-5">
        Backends
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../backends/beam-postgres/" title="beam-postgres" class="md-nav__link">
      beam-postgres
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../backends/beam-sqlite/" title="beam-sqlite" class="md-nav__link">
      beam-sqlite
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../custom-backends/" title="Writing a Custom Backend" class="md-nav__link">
      Writing a Custom Backend
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-6" type="checkbox" id="nav-6">
    
    <label class="md-nav__link" for="nav-6">
      Reference
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-6">
        Reference
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../reference/models/" title="Models" class="md-nav__link">
      Models
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../reference/expression/" title="Expressions" class="md-nav__link">
      Expressions
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../reference/queries/" title="Queries" class="md-nav__link">
      Queries
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../reference/extensibility/" title="Extending" class="md-nav__link">
      Extending
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-7" type="checkbox" id="nav-7">
    
    <label class="md-nav__link" for="nav-7">
      About
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-7">
        About
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../about/compatibility/" title="Compatibility Matrix" class="md-nav__link">
      Compatibility Matrix
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../about/license/" title="License" class="md-nav__link">
      License
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../about/release-notes/" title="Release Notes" class="md-nav__link">
      Release Notes
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
  
    <label class="md-nav__title" for="toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#a-simple-model" title="A Simple Model" class="md-nav__link">
    A Simple Model
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#foreign-references" title="Foreign references" class="md-nav__link">
    Foreign references
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#embedding" title="Embedding" class="md-nav__link">
    Embedding
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#defaults" title="Defaults" class="md-nav__link">
    Defaults
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#what-about-tables-without-primary-keys" title="What about tables without primary keys?" class="md-nav__link">
    What about tables without primary keys?
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#more-complicated-relationships" title="More complicated relationships" class="md-nav__link">
    More complicated relationships
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#putting-a-database-together" title="Putting a Database Together" class="md-nav__link">
    Putting a Database Together
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#using-your-database" title="Using your database" class="md-nav__link">
    Using your database
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#a-quick-note-on-backends" title="A quick note on backends" class="md-nav__link">
    A quick note on backends
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#inserting-data" title="Inserting data" class="md-nav__link">
    Inserting data
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                
                  <h1>Models</h1>
                
                <p>Beam allows you to define models for your data that can be used across multiple
backends. Beam models are standard Haskell data structures, but with some extra
features that allow Beam to introspect them at run-time.</p>
<h2 id="a-simple-model">A Simple Model</h2>
<p>Let's define a simple model to represent a person. Open up a file named
<code>Schema.hs</code> and add the following.</p>
<div class="codehilite"><pre><span></span><span class="cm">{-# LANGUAGE GADTs #-}</span>
<span class="cm">{-# LANGUAGE DeriveGeneric #-}</span>
<span class="kr">module</span> <span class="nn">Schema</span> <span class="kr">where</span>

<span class="kr">import</span> <span class="nn">Database.Beam</span>
<span class="kr">import</span> <span class="nn">Database.Beam.SQLite</span>
<span class="kr">import</span> <span class="nn">Database.SQLite.Simple</span>

<span class="kr">import</span> <span class="nn">Data.Text</span> <span class="p">(</span><span class="kt">Text</span><span class="p">)</span>

<span class="kr">data</span> <span class="kt">PersonT</span> <span class="n">f</span>
    <span class="ow">=</span> <span class="kt">Person</span>
    <span class="p">{</span> <span class="n">personFirstName</span> <span class="ow">::</span> <span class="kt">Columnar</span> <span class="n">f</span> <span class="kt">Text</span>
    <span class="p">,</span> <span class="n">personLastName</span>  <span class="ow">::</span> <span class="kt">Columnar</span> <span class="n">f</span> <span class="kt">Text</span>
    <span class="p">,</span> <span class="n">personAge</span>       <span class="ow">::</span> <span class="kt">Columnar</span> <span class="n">f</span> <span class="kt">Int</span>
    <span class="p">}</span> <span class="kr">deriving</span> <span class="kt">Generic</span>
<span class="kr">instance</span> <span class="kt">Beamable</span> <span class="kt">PersonT</span>
</pre></div>


<p>Beam also requires that your tables have a primary key that can be used to
uniquely identify each tuple in your relation. We tell beam about the primary
key by implementing the <code>Table</code> type class for your table.</p>
<div class="codehilite"><pre><span></span><span class="kr">instance</span> <span class="kt">Table</span> <span class="kt">PersonT</span> <span class="kr">where</span>
  <span class="kr">data</span> <span class="kt">PrimaryKey</span> <span class="kt">PersonT</span> <span class="n">f</span>
      <span class="ow">=</span> <span class="kt">PersonKey</span>
      <span class="p">{</span> <span class="n">personKeyFirstName</span> <span class="ow">::</span> <span class="kt">Columnar</span> <span class="n">f</span> <span class="kt">Text</span>
      <span class="p">,</span> <span class="n">personKeyLastName</span>  <span class="ow">::</span> <span class="kt">Columnar</span> <span class="n">f</span> <span class="kt">Text</span>
      <span class="p">}</span> <span class="kr">deriving</span> <span class="kt">Generic</span>
  <span class="n">primaryKey</span> <span class="n">person</span> <span class="ow">=</span> <span class="kt">PersonKey</span> <span class="p">(</span><span class="n">personFirstName</span> <span class="n">person</span><span class="p">)</span> <span class="p">(</span><span class="n">personLastName</span> <span class="n">person</span><span class="p">)</span>
</pre></div>


<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Using the first and last name as a primary key is a bad idea, we use it here
to illustrate using multiple fields as the primary key.</p>
</div>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>Many people find it useful to use the <code>Applicative</code> instance for <code>(-&gt;) a</code> to
write <code>primaryKey</code>. For example, we could have written the above <code>primaryKey
person = PersonKey (personFirstName person) (personLastName person)</code> as
<code>primaryKey = PersonKey &lt;$&gt; personFirstName &lt;*&gt; personLastName</code>.</p>
</div>
<p>For ease-of-use purposes we define some type synonyms for <code>PersonT</code> and
<code>PrimaryKey PersonT</code> and some convenient instances. These are not strictly
required but make working with these tables much easier.</p>
<div class="codehilite"><pre><span></span><span class="kr">type</span> <span class="kt">Person</span> <span class="ow">=</span> <span class="kt">PersonT</span> <span class="kt">Identity</span>
<span class="kr">type</span> <span class="kt">PersonKey</span> <span class="ow">=</span> <span class="kt">PrimaryKey</span> <span class="kt">PersonT</span> <span class="kt">Identity</span>
<span class="kr">deriving</span> <span class="kr">instance</span> <span class="kt">Show</span> <span class="kt">Person</span><span class="p">;</span> <span class="kr">deriving</span> <span class="kr">instance</span> <span class="kt">Eq</span> <span class="kt">Person</span>
<span class="kr">deriving</span> <span class="kr">instance</span> <span class="kt">Show</span> <span class="kt">PersonKey</span><span class="p">;</span> <span class="kr">deriving</span> <span class="kr">instance</span> <span class="kt">Eq</span> <span class="kt">PersonKey</span>
</pre></div>


<p>Due to the magic of the <code>Columnar</code> type family, the <code>Person</code> type can
be thought of as having the following definition.</p>
<div class="codehilite"><pre><span></span><span class="kr">data</span> <span class="kt">Person</span>
    <span class="ow">=</span> <span class="kt">Person</span>
    <span class="p">{</span> <span class="n">personFirstName</span> <span class="ow">::</span> <span class="kt">Text</span>
    <span class="p">,</span> <span class="n">personLastName</span>  <span class="ow">::</span> <span class="kt">Text</span>
    <span class="p">,</span> <span class="n">personAge</span>       <span class="ow">::</span> <span class="kt">Int</span>
    <span class="p">}</span> <span class="kr">deriving</span> <span class="p">(</span><span class="kt">Show</span><span class="p">,</span> <span class="kt">Eq</span><span class="p">)</span>
</pre></div>


<p>This allows us to use your type definitions for Beam as regular
Haskell data structures without wrapping/unwrapping.</p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>Typing <code>Columnar</code> may become tiresome. <code>Database.Beam</code> also exports <code>C</code> as a
type alias for <code>Columnar</code>, which may make writing models easier. Since <code>C</code>
may cause name clashes, all examples are given using <code>Columnar</code>.</p>
</div>
<h2 id="foreign-references">Foreign references</h2>
<p>Foreign references are also easily supported in models by simply
embedding the <code>PrimaryKey</code> of the referred to table directly in the
parent. For example, suppose we want to create a new model
representing a post by a user.</p>
<div class="codehilite"><pre><span></span><span class="kr">data</span> <span class="kt">PostT</span> <span class="n">f</span>
    <span class="ow">=</span> <span class="kt">Post</span>
    <span class="p">{</span> <span class="n">postId</span>       <span class="ow">::</span> <span class="kt">Columnar</span> <span class="n">f</span> <span class="p">(</span><span class="kt">Auto</span> <span class="kt">Int</span><span class="p">)</span>
    <span class="p">,</span> <span class="n">postPostedAt</span> <span class="ow">::</span> <span class="kt">Columnar</span> <span class="n">f</span> <span class="kt">LocalTime</span>
    <span class="p">,</span> <span class="n">postContent</span>  <span class="ow">::</span> <span class="kt">Columnar</span> <span class="n">f</span> <span class="kt">Text</span>
    <span class="p">,</span> <span class="n">postPoster</span>   <span class="ow">::</span> <span class="kt">PrimaryKey</span> <span class="kt">PersonT</span> <span class="n">f</span>
    <span class="p">}</span> <span class="kr">deriving</span> <span class="kt">Generic</span>
<span class="kr">instance</span> <span class="kt">Beamable</span> <span class="kt">PostT</span>

<span class="kr">instance</span> <span class="kt">Table</span> <span class="kt">PostT</span> <span class="kr">where</span>
  <span class="kr">data</span> <span class="kt">PrimaryKey</span> <span class="kt">PostT</span> <span class="n">f</span>
      <span class="ow">=</span> <span class="kt">PostId</span> <span class="p">(</span><span class="kt">Columnar</span> <span class="n">f</span> <span class="p">(</span><span class="kt">Auto</span> <span class="kt">Int</span><span class="p">))</span> <span class="kr">deriving</span> <span class="kt">Generic</span>
  <span class="n">primaryKey</span> <span class="ow">=</span> <span class="kt">PostId</span> <span class="o">.</span> <span class="n">postId</span>

<span class="kr">type</span> <span class="kt">Post</span> <span class="ow">=</span> <span class="kt">PostT</span> <span class="kt">Identity</span>
<span class="kr">type</span> <span class="kt">PostId</span> <span class="ow">=</span> <span class="kt">PrimaryKey</span> <span class="kt">PostT</span> <span class="kt">Identity</span>
<span class="kr">deriving</span> <span class="kr">instance</span> <span class="kt">Show</span> <span class="kt">Post</span><span class="p">;</span> <span class="kr">deriving</span> <span class="kr">instance</span> <span class="kt">Eq</span> <span class="kt">Post</span>
<span class="kr">deriving</span> <span class="kr">instance</span> <span class="kt">Show</span> <span class="kt">PostId</span><span class="p">;</span> <span class="kr">deriving</span> <span class="kr">instance</span> <span class="kt">Eq</span> <span class="kt">PostId</span>
</pre></div>


<p>The <code>Auto</code> type constructor is provided by <code>beam-core</code> for fields that
are automatically assigned by the database. Internally, <code>Auto x</code> is
simply a newtype over <code>Maybe x</code>. The guarantee is that all values of
type <code>Auto x</code> returned by beam in the result set will have a value,
although this guarantee is not enforced at the type level (yet).</p>
<h2 id="embedding">Embedding</h2>
<p>Sometimes, we want to declare multiple models with fields in common. Beam allows
you to simple embed such fields in common types and embed those directly into
models. For example, in the Chinook example schema (see
<code>beam-sqlite/examples/Chinook/Schema.hs</code>), we define the following structure for
addresses.</p>
<div class="codehilite"><pre><span></span><span class="kr">data</span> <span class="kt">AddressMixin</span> <span class="n">f</span>
  <span class="ow">=</span> <span class="kt">Address</span>
  <span class="p">{</span> <span class="n">address</span>           <span class="ow">::</span> <span class="kt">Columnar</span> <span class="n">f</span> <span class="p">(</span><span class="kt">Maybe</span> <span class="kt">Text</span><span class="p">)</span>
  <span class="p">,</span> <span class="n">addressCity</span>       <span class="ow">::</span> <span class="kt">Columnar</span> <span class="n">f</span> <span class="p">(</span><span class="kt">Maybe</span> <span class="kt">Text</span><span class="p">)</span>
  <span class="p">,</span> <span class="n">addressState</span>      <span class="ow">::</span> <span class="kt">Columnar</span> <span class="n">f</span> <span class="p">(</span><span class="kt">Maybe</span> <span class="kt">Text</span><span class="p">)</span>
  <span class="p">,</span> <span class="n">addressCountry</span>    <span class="ow">::</span> <span class="kt">Columnar</span> <span class="n">f</span> <span class="p">(</span><span class="kt">Maybe</span> <span class="kt">Text</span><span class="p">)</span>
  <span class="p">,</span> <span class="n">addressPostalCode</span> <span class="ow">::</span> <span class="kt">Columnar</span> <span class="n">f</span> <span class="p">(</span><span class="kt">Maybe</span> <span class="kt">Text</span><span class="p">)</span>
  <span class="p">}</span> <span class="kr">deriving</span> <span class="kt">Generic</span>
<span class="kr">instance</span> <span class="kt">Beamable</span> <span class="kt">AddressMixin</span>
<span class="kr">type</span> <span class="kt">Address</span> <span class="ow">=</span> <span class="kt">AddressMixin</span> <span class="kt">Identity</span>
<span class="kr">deriving</span> <span class="kr">instance</span> <span class="kt">Show</span> <span class="p">(</span><span class="kt">AddressMixin</span> <span class="kt">Identity</span><span class="p">)</span>
</pre></div>


<p>We can then use <code>AddressMixin</code> in our models.</p>
<div class="codehilite"><pre><span></span><span class="kr">data</span> <span class="kt">EmployeeT</span> <span class="n">f</span>
  <span class="ow">=</span> <span class="kt">Employee</span>
  <span class="p">{</span> <span class="n">employeeId</span>        <span class="ow">::</span> <span class="kt">Columnar</span> <span class="n">f</span> <span class="kt">Int32</span>
  <span class="p">,</span> <span class="n">employeeLastName</span>  <span class="ow">::</span> <span class="kt">Columnar</span> <span class="n">f</span> <span class="kt">Text</span>
  <span class="p">,</span> <span class="n">employeeFirstName</span> <span class="ow">::</span> <span class="kt">Columnar</span> <span class="n">f</span> <span class="kt">Text</span>
  <span class="p">,</span> <span class="n">employeeTitle</span>     <span class="ow">::</span> <span class="kt">Columnar</span> <span class="n">f</span> <span class="p">(</span><span class="kt">Maybe</span> <span class="kt">Text</span><span class="p">)</span>
  <span class="p">,</span> <span class="n">employeeReportsTo</span> <span class="ow">::</span> <span class="kt">PrimaryKey</span> <span class="kt">EmployeeT</span> <span class="p">(</span><span class="kt">Nullable</span> <span class="n">f</span><span class="p">)</span>
  <span class="p">,</span> <span class="n">employeeBirthDate</span> <span class="ow">::</span> <span class="kt">Columnar</span> <span class="n">f</span> <span class="p">(</span><span class="kt">Maybe</span> <span class="kt">LocalTime</span><span class="p">)</span>
  <span class="p">,</span> <span class="n">employeeHireDate</span>  <span class="ow">::</span> <span class="kt">Columnar</span> <span class="n">f</span> <span class="p">(</span><span class="kt">Maybe</span> <span class="kt">LocalTime</span><span class="p">)</span>
  <span class="p">,</span> <span class="n">employeeAddress</span>   <span class="ow">::</span> <span class="kt">AddressMixin</span> <span class="n">f</span>
  <span class="p">,</span> <span class="n">employeePhone</span>     <span class="ow">::</span> <span class="kt">Columnar</span> <span class="n">f</span> <span class="p">(</span><span class="kt">Maybe</span> <span class="kt">Text</span><span class="p">)</span>
  <span class="p">,</span> <span class="n">employeeFax</span>       <span class="ow">::</span> <span class="kt">Columnar</span> <span class="n">f</span> <span class="p">(</span><span class="kt">Maybe</span> <span class="kt">Text</span><span class="p">)</span>
  <span class="p">,</span> <span class="n">employeeEmail</span>     <span class="ow">::</span> <span class="kt">Columnar</span> <span class="n">f</span> <span class="p">(</span><span class="kt">Maybe</span> <span class="kt">Text</span><span class="p">)</span>
  <span class="p">}</span> <span class="kr">deriving</span> <span class="kt">Generic</span>
<span class="c1">-- ...</span>
<span class="kr">data</span> <span class="kt">CustomerT</span> <span class="n">f</span>
  <span class="ow">=</span> <span class="kt">Customer</span>
  <span class="p">{</span> <span class="n">customerId</span>        <span class="ow">::</span> <span class="kt">Columnar</span> <span class="n">f</span> <span class="kt">Int32</span>
  <span class="p">,</span> <span class="n">customerFirstName</span> <span class="ow">::</span> <span class="kt">Columnar</span> <span class="n">f</span> <span class="kt">Text</span>
  <span class="p">,</span> <span class="n">customerLastName</span>  <span class="ow">::</span> <span class="kt">Columnar</span> <span class="n">f</span> <span class="kt">Text</span>
  <span class="p">,</span> <span class="n">customerCompany</span>   <span class="ow">::</span> <span class="kt">Columnar</span> <span class="n">f</span> <span class="p">(</span><span class="kt">Maybe</span> <span class="kt">Text</span><span class="p">)</span>
  <span class="p">,</span> <span class="n">customerAddress</span>   <span class="ow">::</span> <span class="kt">AddressMixin</span> <span class="n">f</span>
  <span class="p">,</span> <span class="n">customerPhone</span>     <span class="ow">::</span> <span class="kt">Columnar</span> <span class="n">f</span> <span class="p">(</span><span class="kt">Maybe</span> <span class="kt">Text</span><span class="p">)</span>
  <span class="p">,</span> <span class="n">customerFax</span>       <span class="ow">::</span> <span class="kt">Columnar</span> <span class="n">f</span> <span class="p">(</span><span class="kt">Maybe</span> <span class="kt">Text</span><span class="p">)</span>
  <span class="p">,</span> <span class="n">customerEmail</span>     <span class="ow">::</span> <span class="kt">Columnar</span> <span class="n">f</span> <span class="kt">Text</span>
  <span class="p">,</span> <span class="n">customerSupportRep</span> <span class="ow">::</span> <span class="kt">PrimaryKey</span> <span class="kt">EmployeeT</span> <span class="p">(</span><span class="kt">Nullable</span> <span class="n">f</span><span class="p">)</span>
  <span class="p">}</span> <span class="kr">deriving</span> <span class="kt">Generic</span>
</pre></div>


<h2 id="defaults">Defaults</h2>
<p>Based on your data type declarations, beam can already guess a lot
about your tables. For example, it already assumes that the
<code>personFirstName</code> field is accessible in SQL as <code>first_name</code>. This
defaulting behavior makes it very easy to interact with typical
databases.</p>
<p>For the easiest user experience, it's best to follow beam's
conventions for declaring models. In particular, the defaulting
mechanisms rely on each table type declaring only one constructor
which has fields named in the camelCase style.</p>
<p>When defaulting the name of a table field or column, beam
un-camelCases the field name (after dropping leading underscores) and
drops the first word. The remaining words are joined with
underscores. If there is only one component, it is not
dropped. Trailing and internal underscores are preserved in the name
and if the name consists solely of underscores, beam makes no
changes. A summary of these rules is given in the table below.</p>
<table>
<thead>
<tr>
<th align="left">Haskell field name</th>
<th align="left">Beam defaulted column name</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left"><code>personFirstName</code></td>
<td align="left"><code>first_name</code></td>
</tr>
<tr>
<td align="left"><code>_personLastName</code></td>
<td align="left"><code>last_name</code></td>
</tr>
<tr>
<td align="left"><code>name</code></td>
<td align="left"><code>name</code></td>
</tr>
<tr>
<td align="left"><code>first_name</code></td>
<td align="left"><code>first_name</code></td>
</tr>
<tr>
<td align="left"><code>_first_name</code></td>
<td align="left"><code>first_name</code></td>
</tr>
<tr>
<td align="left"><code>___</code> (three underscores)</td>
<td align="left"><code>___</code> (no changes)</td>
</tr>
</tbody>
</table>
<p>Note that beam only uses lower case in field names. While typically
case does not matter for SQL queries, beam always quotes
identifiers. Many DBMS's are case-sensitive for quoted
identifiers. Thus, queries can sometimes fail if your tables use
mixtures of lower- and upper-case to distinguish between fields.</p>
<p>All of these defaults can be overriden using the modifications system,
described in the <a href="../../reference/models/">model reference</a>.</p>
<h2 id="what-about-tables-without-primary-keys">What about tables without primary keys?</h2>
<p>Tables without primary keys are considered bad style. However,
sometimes you need to use beam with a schema that you have no control
over. To declare a table without a primary key, simply instantiate the
<code>Table</code> class without overriding the defaults.</p>
<h2 id="more-complicated-relationships">More complicated relationships</h2>
<p>This is the extent of beam's support for defining models. Although
similar packages in other languages provide support for declaring
one-to-many, many-to-one, and many-to-many relationships, beam's
focused is providing a direct mapping of relational database concepts
to Haskell, not on abstracting away the complexities of database
querying. Thus, beam does not use 'lazy-loading' or other tricks that
obfuscate performance. Because of this, the bulk of the functionality
dealing with different types of relations is found in the querying
support, rather than in the model declarations.</p>
<h2 id="putting-a-database-together">Putting a Database Together</h2>
<p>Beam also requires you to give a type for your database. The database type
contains all the entities (tables or otherwise) that would be present in your
database. Our database only has one table right now, so it only contains one
field.</p>
<div class="codehilite"><pre><span></span><span class="kr">data</span> <span class="kt">ExampleDb</span> <span class="n">f</span>
    <span class="ow">=</span> <span class="kt">ExampleDb</span>
    <span class="p">{</span> <span class="n">persons</span> <span class="ow">::</span> <span class="n">f</span> <span class="p">(</span><span class="kt">TableEntity</span> <span class="kt">PersonT</span><span class="p">)</span>
    <span class="p">}</span> <span class="kr">deriving</span> <span class="kt">Generic</span>
<span class="kr">instance</span> <span class="kt">Database</span> <span class="kt">ExampleDb</span>

<span class="nf">exampleDb</span> <span class="ow">::</span> <span class="kt">DatabaseSettings</span> <span class="n">be</span> <span class="kt">ExampleDb</span>
<span class="nf">exampleDb</span> <span class="ow">=</span> <span class="n">autoDbSettings</span>
</pre></div>


<h2 id="using-your-database">Using your database</h2>
<p>Let's open up a SQLite database. Open up <code>ghci</code> and import your module.</p>
<div class="codehilite"><pre><span></span>Prelude<span class="o">&gt;</span> <span class="o">:</span>load Schema.hs
Prelude Schema<span class="o">&gt;</span> conn <span class="o">&lt;-</span> open <span class="s">&quot;beam-manual.db&quot;</span>
</pre></div>


<h3 id="a-quick-note-on-backends">A quick note on backends</h3>
<p>Beam is backend-agnostic and doesn't provide any means to connect to a
database. Beam backend libraries usually use well-used Haskell
libraries to provide database connectivity. For example, the
<code>beam-sqlite</code> backend uses the <code>sqlite-simple</code> backend.</p>
<p>Beam distinguishes each backend via type indexes. Each backend defines
a type that is used to enable backend-specific behavior. For example,
the <code>beam-sqlite</code> backend ships with the <code>Sqlite</code> type that is used to
distinguish sqlite specific constructs with generic or other
backend-specific ones.</p>
<p>Each backend can have one or more 'syntaxes', which are particular
ways to query the database. While the <code>beam-core</code> library ships with a
standard ANSI SQL builder, few real-world database implementations
fully follow the standard. Most backends use their own custom syntax
type. Internally, beam uses a finally-tagless representation for
syntax trees that allow straightforward construction against any
backend.</p>
<p>Beam offers backend-generic functions for the most common operations
against databases. These functions are meant to fit the lowest common
denominator. For example, no control is offered over streaming results
from SELECT statements. While these backend-generic functions are
useful for ad-hoc querying and development, it is wisest to use
backend-specific functions in production for maximum control. Refer to
backend-specific documentation for more information.</p>
<p>For our examples, we will use the <code>beam-sqlite</code> backend and demonstrate
usage of the beam standard query functions.</p>
<h3 id="inserting-data">Inserting data</h3>
<p>First, let's connect to a sqlite database, and create our schema. The
<code>beam-core</code> does not offer any support for the SQL DDL language. There
is a separate core library <code>beam-migrate</code> that offers complete support
for ANSI-standard SQL DDL operations, as well as tools to manipulate
database schemas. See the section on migrations for more information.</p>
<p>For our example, we will simply issue a <code>CREATE TABLE</code> command
directly against the database using <code>sqlite-simple</code> functionality:</p>
<div class="codehilite"><pre><span></span>Prelude Schema&gt; execute_ conn &quot;CREATE TABLE persons ( first_name TEXT NOT NULL, last_name TEXT NOT NULL, age INT NOT NULL, PRIMARY KEY(first_name, last_name) )&quot;
</pre></div>


<p>Now we can insert some data into our database. Beam ships with a
function <code>withDatabase</code>, with the following signature:</p>
<div class="codehilite"><pre><span></span><span class="nf">withDatabase</span> <span class="ow">::</span> <span class="kt">MonadBeam</span> <span class="n">syntax</span> <span class="n">be</span> <span class="n">m</span> <span class="ow">=&gt;</span> <span class="kt">DbHandle</span> <span class="n">be</span> <span class="ow">-&gt;</span> <span class="n">m</span> <span class="n">a</span> <span class="ow">-&gt;</span> <span class="kt">IO</span> <span class="n">a</span>
</pre></div>


<p><code>DbHandle be</code> is a type family that refers to a backend-specific type
for referring to a particular database connection. For the
<code>beam-sqlite</code> backend <code>DbHandle Sqlite ~
Database.Sqlite.Simple.Connection</code>. </p>
<p><code>MonadBeam</code> is a type class relating a particular syntax and backend
to a monad we can use to execute data query and manipulation commands.</p>
<p>Let's insert some data into our database. We are going to use the
<code>runInsert</code> function from <code>MonadBeam</code>.</p>
<div class="codehilite"><pre><span></span>Prelude Schema&gt; :{
Prelude Schema| withDatabase conn $ do
Prelude Schema|   runInsert $ insert (persons exampleDb) $
Prelude Schema|               insertValues [ Person &quot;Bob&quot; &quot;Smith&quot; 50
Prelude Schema|                            , Person &quot;Alice&quot; &quot;Wong&quot; 55
Prelude Schema|                            , Person &quot;John&quot; &quot;Quincy&quot; 30 ]
Prelude Schema| :}
</pre></div>


<p>The <code>runInsert</code> function has the type signature</p>
<div class="codehilite"><pre><span></span><span class="nf">runInsert</span> <span class="ow">::</span> <span class="kt">MonadBeam</span> <span class="n">syntax</span> <span class="n">be</span> <span class="n">m</span> <span class="ow">=&gt;</span> <span class="kt">SqlInsert</span> <span class="n">syntax</span> <span class="ow">-&gt;</span> <span class="n">m</span> <span class="nb">()</span>
</pre></div>


<p><code>SqlInsert syntax</code> represents a SQL <code>INSERT</code> command in the given
<code>syntax</code>. We construct this value using the <code>insert</code> function from
<code>Database.Beam.Query</code>.</p>
<div class="codehilite"><pre><span></span><span class="nf">insert</span> <span class="ow">::</span> <span class="kt">IsSql92InsertSyntax</span> <span class="n">syntax</span> <span class="ow">=&gt;</span>
          <span class="kt">DatabaseEntity</span> <span class="n">be</span> <span class="n">db</span> <span class="p">(</span><span class="kt">TableEntity</span> <span class="n">table</span><span class="p">)</span>
       <span class="ow">-&gt;</span> <span class="kt">Sql92InsertValuesSyntax</span> <span class="n">syntax</span>
       <span class="ow">-&gt;</span> <span class="kt">SqlInsert</span> <span class="n">syntax</span>
</pre></div>


<p>Intuitively, <code>insert</code> takes a database table descriptor and some
values (particular to the given syntax) and returns a statement to
insert these values. <code>Sql92InsertValuesSyntax syntax</code> always
implements the <code>IsSql92InsertValuesSyntax</code> typeclass, which is where
we get the <code>insertValues</code> function from. <code>IsSql92InsertValuesSyntax</code>
also defines the <code>insertSelect</code> function for inserting values from the
result of a <code>SELECT</code> statement. Other backends may provide other ways
of specifying the source of values. This brings us to another point</p>
<div class="codehilite"><pre><span></span>Prelude Schema&gt; runSelect (select (all_ (persons exampleDb)))
[ Person { personFirstName = &quot;Bob&quot;, personLastName=&quot;Smith&quot;, personAge=50 }, ... ]
</pre></div>
                
                  
                
              
              
                
              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../getting-started/" title="Getting Started" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Getting Started
              </span>
            </div>
          </a>
        
        
          <a href="../databases/" title="Databases" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                Databases
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        powered by
        <a href="http://www.mkdocs.org" title="MkDocs">MkDocs</a>
        and
        <a href="http://squidfunk.github.io/mkdocs-material/" title="Material for MkDocs">
          Material for MkDocs</a>
      </div>
      
        
      
    </div>
  </div>
</footer>
      
    </div>
    

      <script src="../../assets/javascripts/application-6b599127bc.js"></script>
      <script>app.initialize({url:{base:"../.."}})</script>
      
    
<script type="text/javascript" language="javascript"  src="http://code.jquery.com/jquery-2.2.4.min.js"></script>
<script type="text/javascript" language="javascript" src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
<script type="text/javascript" language="javascript">
 $(document.body).tab();
 $(".nav-item:first-child").tab("show");
</script>

    
      
    
  </body>
</html>