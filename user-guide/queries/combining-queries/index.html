<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  
  <link rel="shortcut icon" href="../../../img/favicon.ico">
  <title>Combining queries - Beam Documentation</title>

  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  <link rel="stylesheet" href="../../../css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../css/theme_extra.css" type="text/css" />
  <link rel="stylesheet" href="../../../css/highlight.css">
  <link href="../../../theme/css/beam.css" rel="stylesheet">
<link rel="stylesheet" type="text/css" href="css/beam.css"/>

  
  <script>
    // Current page data
    var mkdocs_page_name = "Combining queries";
    var mkdocs_page_input_path = "user-guide/queries/combining-queries.md";
    var mkdocs_page_url = "/user-guide/queries/combining-queries/";
  </script>
  
  <script src="../../../js/jquery-2.1.1.min.js"></script>
  <script src="../../../js/modernizr-2.8.3.min.js"></script>
  <script type="text/javascript" src="../../../js/highlight.pack.js"></script> 
  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
      <div class="wy-side-nav-search">
        <a href="../../.." class="icon icon-home"> Beam Documentation</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
	<ul class="current">
	  
          
            <li class="toctree-l1">
		
    <a class="" href="../../..">Home</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../../../about/faq/">Frequently Asked Questions</a>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">User Guide</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../../getting-started/">Getting Started</a>
                </li>
                <li class="">
                    
    <a class="" href="../../models/">Models</a>
                </li>
                <li class="">
                    
    <a class="" href="../../databases/">Databases</a>
                </li>
                <li class="">
                    
    <a class="" href="../basic/">Basic Queries</a>
                </li>
                <li class="">
                    
    <a class="" href="../select/">More complex SELECTs</a>
                </li>
                <li class="">
                    
    <a class="" href="../ordering/">Ordering</a>
                </li>
                <li class="">
                    
    <a class="" href="../relationships/">Relationships</a>
                </li>
                <li class="">
                    
    <a class="" href="../aggregates/">Aggregates</a>
                </li>
                <li class=" current">
                    
    <a class="current" href="./">Combining queries</a>
    <ul class="subnav">
            
    <li class="toctree-l3"><a href="#sql-set-operations">SQL Set operations</a></li>
    
        <ul>
        
            <li><a class="toctree-l4" href="#combining-arbitrary-set-expressions">Combining arbitrary set expressions</a></li>
        
        </ul>
    

    <li class="toctree-l3"><a href="#limitoffset-and-set-operations">LIMIT/OFFSET and set operations</a></li>
    

    </ul>
                </li>
                <li class="">
                    
    <a class="" href="../window-functions/">Window functions</a>
                </li>
                <li class="">
                    
    <a class="" href="../advanced-features/">Advanced features</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Schema management</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../../../schema-guide/migrations/">The Migrations Framework</a>
                </li>
                <li class="">
                    
    <a class="" href="../../../schema-guide/tool/">The beam-migrate tool</a>
                </li>
                <li class="">
                    
    <a class="" href="../../../schema-guide/supported/">Supported migrations</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Backends</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../../backends/beam-postgres/">beam-postgres</a>
                </li>
                <li class="">
                    
    <a class="" href="../../backends/beam-sqlite/">beam-sqlite</a>
                </li>
                <li class="">
                    
    <a class="" href="../../custom-backends/">Writing a Custom Backend</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Reference</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../../../reference/models/">Models</a>
                </li>
                <li class="">
                    
    <a class="" href="../../../reference/expression/">Expressions</a>
                </li>
                <li class="">
                    
    <a class="" href="../../../reference/queries/">Queries</a>
                </li>
                <li class="">
                    
    <a class="" href="../../../reference/extensibility/">Extending</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">About</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../../../about/compatibility/">Compatibility Matrix</a>
                </li>
                <li class="">
                    
    <a class="" href="../../../about/license/">License</a>
                </li>
                <li class="">
                    
    <a class="" href="../../../about/release-notes/">Release Notes</a>
                </li>
    </ul>
	    </li>
          
        </ul>
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../../..">Beam Documentation</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../../..">Docs</a> &raquo;</li>
    
      
        
          <li>User Guide &raquo;</li>
        
      
    
    <li>Combining queries</li>
    <li class="wy-breadcrumbs-aside">
      
    </li>
  </ul>
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <p>SQL lets you combine the results of multiple <code>SELECT</code> statements using the
<code>UNION</code>, <code>INTERSECT</code>, and <code>EXCEPT</code> clauses.</p>
<h2 id="sql-set-operations">SQL Set operations</h2>
<p>The SQL Set operations are provided as the <code>union_</code>, <code>intersect_</code>, and <code>except_</code>
functions. SQL also allows an optional <code>ALL</code> clause to be specified with each of
these. Beam implements these as <code>unionAll_</code>, <code>intersectAll_</code>, and <code>exceptAll_</code>
respectively. Each combinator takes two queries as arguments. The results of
both queries will be combined accordingly. The returned type is the same as the
type of both query arguments, which must be the same.</p>
<p>For example, suppose we wanted the first and last names of both customers and
employees.</p>
<p>
                <div class="code-nav-container">
                    
        <ul class="nav nav-tabs">
            
        <li class="nav-item">
            <a href="#tab-0-haskell" aria-controls="tab-0-haskell" role="tab" data-toggle="tab" data-lang="haskell">Haskell</a>
        </li>
    
        <li class="nav-item">
            <a href="#tab-0-sqlite3" aria-controls="tab-0-sqlite3" role="tab" data-toggle="tab" data-lang="sqlite3">Sqlite3</a>
        </li>
    
        <li class="nav-item">
            <a href="#tab-0-postgres" aria-controls="tab-0-postgres" role="tab" data-toggle="tab" data-lang="postgres">Postgres</a>
        </li>
    
        </ul>
    
        <div class="tab-content">
            
        <div role="tabpanel" class="tab-pane active" id="tab-0-haskell">
            <pre><code  class="haskell">let customerNames =
      fmap (\c -&gt; (customerFirstName c, customerLastName c))
           (all_ (customer chinookDb))
    employeeNames =
      fmap (\e -&gt; (employeeFirstName e, employeeLastName e))
           (all_ (employee chinookDb))
in union_ customerNames employeeNames
</code></pre>
        </div>
    
        <div role="tabpanel" class="tab-pane " id="tab-0-sqlite3">
            <pre><code  class="sqlite3">SELECT &quot;t0&quot;.&quot;FirstName&quot; AS &quot;res0&quot;,
       &quot;t0&quot;.&quot;LastName&quot; AS &quot;res1&quot;
FROM &quot;Customer&quot; AS &quot;t0&quot;
UNION
SELECT &quot;t0&quot;.&quot;FirstName&quot; AS &quot;res0&quot;,
       &quot;t0&quot;.&quot;LastName&quot; AS &quot;res1&quot;
FROM &quot;Employee&quot; AS &quot;t0&quot;
</code></pre>
        </div>
    
        <div role="tabpanel" class="tab-pane " id="tab-0-postgres">
            <pre><code  class="postgres">
  (SELECT &quot;t0&quot;.&quot;FirstName&quot; AS &quot;res0&quot;,
          &quot;t0&quot;.&quot;LastName&quot; AS &quot;res1&quot;
   FROM &quot;Customer&quot; AS &quot;t0&quot;)
UNION
  (SELECT &quot;t0&quot;.&quot;FirstName&quot; AS &quot;res0&quot;,
          &quot;t0&quot;.&quot;LastName&quot; AS &quot;res1&quot;
   FROM &quot;Employee&quot; AS &quot;t0&quot;)
</code></pre>
        </div>
    
        </div>
    
                </div>
                    </p>
<h3 id="combining-arbitrary-set-expressions">Combining arbitrary set expressions</h3>
<p>Suppose we wanted all employee and customer first names that were also customer
last names but not also employee last names. We could use <code>UNION</code> to combine the
results of a query over the first names of employees and customers, and an
<code>EXCEPT</code> to get all customer last names that were not employee ones. Finally, an
<code>INTERSECT</code> would give us the result we want. The beam query language allows
this and many popular backends do as well, but standard SQL makes it difficult
to express. Beam has decided to go with the most common implement solution,
which is to allow such nesting. This simplifies the API design.</p>
<p>On backends which allow such nesting (like Postgres), the query is translated
directly. On backends that do not (like SQLite), an appropriate subselect is
generated.</p>
<p>
                <div class="code-nav-container">
                    
        <ul class="nav nav-tabs">
            
        <li class="nav-item">
            <a href="#tab-1-haskell" aria-controls="tab-1-haskell" role="tab" data-toggle="tab" data-lang="haskell">Haskell</a>
        </li>
    
        <li class="nav-item">
            <a href="#tab-1-sqlite3" aria-controls="tab-1-sqlite3" role="tab" data-toggle="tab" data-lang="sqlite3">Sqlite3</a>
        </li>
    
        <li class="nav-item">
            <a href="#tab-1-postgres" aria-controls="tab-1-postgres" role="tab" data-toggle="tab" data-lang="postgres">Postgres</a>
        </li>
    
        </ul>
    
        <div class="tab-content">
            
        <div role="tabpanel" class="tab-pane active" id="tab-1-haskell">
            <pre><code  class="haskell">let customerFirstNames =
      fmap customerFirstName
           (all_ (customer chinookDb))
    employeeFirstNames =
      fmap employeeFirstName
           (all_ (employee chinookDb))
    customerLastNames =
      fmap customerLastName
           (all_ (customer chinookDb))
    employeeLastNames =
      fmap employeeLastName
           (all_ (employee chinookDb))
in (customerFirstNames `union_`employeeFirstNames) `intersect_`
   (customerLastNames `except_` employeeLastNames)
</code></pre>
        </div>
    
        <div role="tabpanel" class="tab-pane " id="tab-1-sqlite3">
            <pre><code  class="sqlite3">SELECT &quot;t0&quot;.&quot;res0&quot; AS &quot;res0&quot;
FROM
  (SELECT &quot;t0&quot;.&quot;FirstName&quot; AS &quot;res0&quot;
   FROM &quot;Customer&quot; AS &quot;t0&quot;
   UNION SELECT &quot;t0&quot;.&quot;FirstName&quot; AS &quot;res0&quot;
   FROM &quot;Employee&quot; AS &quot;t0&quot;) AS &quot;t0&quot; INTERSECT
SELECT &quot;t0&quot;.&quot;res0&quot; AS &quot;res0&quot;
FROM
  (SELECT &quot;t0&quot;.&quot;LastName&quot; AS &quot;res0&quot;
   FROM &quot;Customer&quot; AS &quot;t0&quot;
   EXCEPT SELECT &quot;t0&quot;.&quot;LastName&quot; AS &quot;res0&quot;
   FROM &quot;Employee&quot; AS &quot;t0&quot;) AS &quot;t0&quot;
</code></pre>
        </div>
    
        <div role="tabpanel" class="tab-pane " id="tab-1-postgres">
            <pre><code  class="postgres">(
   (SELECT &quot;t0&quot;.&quot;FirstName&quot; AS &quot;res0&quot;
    FROM &quot;Customer&quot; AS &quot;t0&quot;)
 UNION
   (SELECT &quot;t0&quot;.&quot;FirstName&quot; AS &quot;res0&quot;
    FROM &quot;Employee&quot; AS &quot;t0&quot;)) INTERSECT (
                                           (SELECT &quot;t0&quot;.&quot;LastName&quot; AS &quot;res0&quot;
                                            FROM &quot;Customer&quot; AS &quot;t0&quot;)
                                         EXCEPT
                                           (SELECT &quot;t0&quot;.&quot;LastName&quot; AS &quot;res0&quot;
                                            FROM &quot;Employee&quot; AS &quot;t0&quot;))
</code></pre>
        </div>
    
        </div>
    
                </div>
                    </p>
<h2 id="limitoffset-and-set-operations"><code>LIMIT</code>/<code>OFFSET</code> and set operations</h2>
<p>The <code>LIMIT</code> and <code>OFFSET</code> clauses generated by <code>limit_</code> and <code>offset_</code> apply to
the entire result of the set operation. Beam will correctly generate the query
you specify, placing the <code>LIMIT</code> and <code>OFFSET</code> at the appropriate point. If
necessary, it will also generate a sub select to preserve the meaning of the
query.</p>
<p>For example, to get the second ten full names in common.</p>
<p>
                <div class="code-nav-container">
                    
        <ul class="nav nav-tabs">
            
        <li class="nav-item">
            <a href="#tab-2-haskell" aria-controls="tab-2-haskell" role="tab" data-toggle="tab" data-lang="haskell">Haskell</a>
        </li>
    
        <li class="nav-item">
            <a href="#tab-2-sqlite3" aria-controls="tab-2-sqlite3" role="tab" data-toggle="tab" data-lang="sqlite3">Sqlite3</a>
        </li>
    
        <li class="nav-item">
            <a href="#tab-2-postgres" aria-controls="tab-2-postgres" role="tab" data-toggle="tab" data-lang="postgres">Postgres</a>
        </li>
    
        </ul>
    
        <div class="tab-content">
            
        <div role="tabpanel" class="tab-pane active" id="tab-2-haskell">
            <pre><code  class="haskell">let customerNames =
      fmap (\c -&gt; (customerFirstName c, customerLastName c))
           (all_ (customer chinookDb))
    employeeNames =
      fmap (\e -&gt; (employeeFirstName e, employeeLastName e))
           (all_ (employee chinookDb))
in limit_ 10 (union_ customerNames employeeNames)
</code></pre>
        </div>
    
        <div role="tabpanel" class="tab-pane " id="tab-2-sqlite3">
            <pre><code  class="sqlite3">SELECT &quot;t0&quot;.&quot;FirstName&quot; AS &quot;res0&quot;,
       &quot;t0&quot;.&quot;LastName&quot; AS &quot;res1&quot;
FROM &quot;Customer&quot; AS &quot;t0&quot;
UNION
SELECT &quot;t0&quot;.&quot;FirstName&quot; AS &quot;res0&quot;,
       &quot;t0&quot;.&quot;LastName&quot; AS &quot;res1&quot;
FROM &quot;Employee&quot; AS &quot;t0&quot;
LIMIT 10
</code></pre>
        </div>
    
        <div role="tabpanel" class="tab-pane " id="tab-2-postgres">
            <pre><code  class="postgres">
  (SELECT &quot;t0&quot;.&quot;FirstName&quot; AS &quot;res0&quot;,
          &quot;t0&quot;.&quot;LastName&quot; AS &quot;res1&quot;
   FROM &quot;Customer&quot; AS &quot;t0&quot;)
UNION
  (SELECT &quot;t0&quot;.&quot;FirstName&quot; AS &quot;res0&quot;,
          &quot;t0&quot;.&quot;LastName&quot; AS &quot;res1&quot;
   FROM &quot;Employee&quot; AS &quot;t0&quot;)
LIMIT 10
</code></pre>
        </div>
    
        </div>
    
                </div>
                    </p>
<p>If we only wanted the union of the first 10 names of each.</p>
<p>
                <div class="code-nav-container">
                    
        <ul class="nav nav-tabs">
            
        <li class="nav-item">
            <a href="#tab-12-haskell" aria-controls="tab-12-haskell" role="tab" data-toggle="tab" data-lang="haskell">Haskell</a>
        </li>
    
        <li class="nav-item">
            <a href="#tab-12-sqlite3" aria-controls="tab-12-sqlite3" role="tab" data-toggle="tab" data-lang="sqlite3">Sqlite3</a>
        </li>
    
        <li class="nav-item">
            <a href="#tab-12-postgres" aria-controls="tab-12-postgres" role="tab" data-toggle="tab" data-lang="postgres">Postgres</a>
        </li>
    
        </ul>
    
        <div class="tab-content">
            
        <div role="tabpanel" class="tab-pane active" id="tab-12-haskell">
            <pre><code  class="haskell">let customerNames =
      fmap (\c -&gt; (customerFirstName c, customerLastName c))
           (all_ (customer chinookDb))
    employeeNames =
      fmap (\e -&gt; (employeeFirstName e, employeeLastName e))
           (all_ (employee chinookDb))
in union_ (limit_ 10 customerNames) (limit_ 10 employeeNames)
</code></pre>
        </div>
    
        <div role="tabpanel" class="tab-pane " id="tab-12-sqlite3">
            <pre><code  class="sqlite3">SELECT &quot;t0&quot;.&quot;res0&quot; AS &quot;res0&quot;,
       &quot;t0&quot;.&quot;res1&quot; AS &quot;res1&quot;
FROM
  (SELECT &quot;t0&quot;.&quot;FirstName&quot; AS &quot;res0&quot;,
          &quot;t0&quot;.&quot;LastName&quot; AS &quot;res1&quot;
   FROM &quot;Customer&quot; AS &quot;t0&quot;
   LIMIT 10) AS &quot;t0&quot;
UNION
SELECT &quot;t0&quot;.&quot;res0&quot; AS &quot;res0&quot;,
       &quot;t0&quot;.&quot;res1&quot; AS &quot;res1&quot;
FROM
  (SELECT &quot;t0&quot;.&quot;FirstName&quot; AS &quot;res0&quot;,
          &quot;t0&quot;.&quot;LastName&quot; AS &quot;res1&quot;
   FROM &quot;Employee&quot; AS &quot;t0&quot;
   LIMIT 10) AS &quot;t0&quot;
</code></pre>
        </div>
    
        <div role="tabpanel" class="tab-pane " id="tab-12-postgres">
            <pre><code  class="postgres">
  (SELECT &quot;t0&quot;.&quot;res0&quot; AS &quot;res0&quot;,
          &quot;t0&quot;.&quot;res1&quot; AS &quot;res1&quot;
   FROM
     (SELECT &quot;t0&quot;.&quot;FirstName&quot; AS &quot;res0&quot;,
             &quot;t0&quot;.&quot;LastName&quot; AS &quot;res1&quot;
      FROM &quot;Customer&quot; AS &quot;t0&quot;
      LIMIT 10) AS &quot;t0&quot;)
UNION
  (SELECT &quot;t0&quot;.&quot;res0&quot; AS &quot;res0&quot;,
          &quot;t0&quot;.&quot;res1&quot; AS &quot;res1&quot;
   FROM
     (SELECT &quot;t0&quot;.&quot;FirstName&quot; AS &quot;res0&quot;,
             &quot;t0&quot;.&quot;LastName&quot; AS &quot;res1&quot;
      FROM &quot;Employee&quot; AS &quot;t0&quot;
      LIMIT 10) AS &quot;t0&quot;)
</code></pre>
        </div>
    
        </div>
    
                </div>
                    </p>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../window-functions/" class="btn btn-neutral float-right" title="Window functions">Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="../aggregates/" class="btn btn-neutral" title="Aggregates"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
  </div>

  Built with <a href="http://www.mkdocs.org">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
	  
        </div>
      </div>

    </section>
    
  </div>

  <div class="rst-versions" role="note" style="cursor: pointer">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
      
        <span><a href="../aggregates/" style="color: #fcfcfc;">&laquo; Previous</a></span>
      
      
        <span style="margin-left: 15px"><a href="../window-functions/" style="color: #fcfcfc">Next &raquo;</a></span>
      
    </span>
</div>

    <script src="../../../js/theme.js"></script>
<script type="text/javascript" language="javascript" src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
<script type="text/javascript" language="javascript">
 $(document.body).tab();
</script>


</body>
</html>
